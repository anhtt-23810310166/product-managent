extends ../../layouts/default.pug
include ../../mixins/account-sidebar.pug

block main
  .container.py-4
    nav(aria-label="breadcrumb")
      ol.breadcrumb.bg-transparent.px-0.pb-3.pt-0.mb-0.tz-breadcrumb-nav
        li.breadcrumb-item
          a.text-muted(href="/") Trang chủ
        li.breadcrumb-item.active.tz-breadcrumb-active(aria-current="page") Sổ địa chỉ

    .tz-account-layout
      +accountSidebar("address")
      .tz-account-content
        .tz-card
          .tz-card-header.d-flex.justify-content-between.align-items-center
            div
              i.fas.fa-map-marker-alt.mr-2
              | Sổ Địa Chỉ
            a.tz-btn-primary.tz-btn-sm(href=`/user/address/create${req.query.redirect ? '?redirect=checkout' : ''}`)
              i.fas.fa-plus.mr-2
              | Thêm Địa Chỉ
          .tz-card-body
            if (addresses && addresses.length > 0)
              each addr in addresses
                .tz-address-item(
                  class=(req.query.selectedId === addr._id.toString() || (!req.query.selectedId && addr.isDefault)) ? "tz-address-selected" : ""
                  style=req.query.redirect === 'checkout' ? "cursor: pointer;" : ""
                  onclick=req.query.redirect === 'checkout' ? `if(!event.target.closest('a') && !event.target.closest('button')) window.location.href='/cart/checkout?addressId=${addr._id}'` : ""
                )
                  .tz-address-info
                    .tz-address-name
                      span= addr.fullName
                      if addr.isDefault
                        span.tz-address-badge Mặc định
                    .tz-address-detail
                      i.fas.fa-phone.mr-2
                      | #{addr.phone}
                    .tz-address-detail
                      i.fas.fa-map-marker-alt.mr-2
                      | #{addr.address}
                  .tz-address-actions
                    if req.query.redirect === 'checkout'
                      if req.query.selectedId === addr._id.toString()
                        span.tz-address-checked
                          i.fas.fa-check-circle.mr-1
                          | Đang chọn
                    else
                      if !addr.isDefault
                        form(action=`/user/address/set-default/${addr._id}` method="POST" class="d-inline-block")
                          button.tz-btn-outline-sm(type="submit") Thiết lập mặc định
                    .tz-address-links.mt-2
                      a.tz-link-edit(href=`/user/address/edit/${addr._id}${req.query.redirect ? "?redirect=checkout" : ""}`) Sửa
                      if !addr.isDefault
                        form(action=`/user/address/delete/${addr._id}` method="POST" class="d-inline-block form-delete-address")
                          button.tz-link-delete(type="submit") Xoá

            else
              .tz-empty-state-inline
                .tz-empty-icon
                  i.fas.fa-map-marked-alt
                h5 Chưa có địa chỉ
                p Vui lòng thêm địa chỉ nhận hàng của bạn

  script.
    const formsDelete = document.querySelectorAll('.form-delete-address');
    if (formsDelete.length > 0) {
      formsDelete.forEach(form => {
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          if(confirm("Bạn có chắc chắn muốn xoá địa chỉ này?")) {
            form.submit();
          }
        });
      });
    }
