extends ../../layouts/default

block main
  .container.py-4
    //- Breadcrumb
    nav(aria-label="breadcrumb")
      ol.breadcrumb.bg-transparent.px-0.pb-3.pt-0.mb-0.tz-breadcrumb-nav
        li.breadcrumb-item
          a.text-muted(href="/") Trang chủ
        li.breadcrumb-item
          a.text-muted(href="/products") Sản phẩm
        li.breadcrumb-item.active.tz-breadcrumb-active(aria-current="page")= product.title

    //- Product Detail Card
    .card.border-0.shadow-sm.overflow-hidden.mb-5.tz-detail-card
      .row.no-gutters.p-3
        //- Product Image Gallery (Shopee-style)
        .col-lg-5.col-md-6.mb-4.mb-md-0
          .tz-gallery
            .tz-gallery-main.position-relative
              if product.discountPercentage && product.discountPercentage > 0
                .badge.badge-danger.position-absolute.tz-badge-discount-lg 
                  | -#{product.discountPercentage}%
              if product.thumbnail
                img.tz-gallery-main-img#galleryMainImg(src=product.thumbnail alt=product.title)
              else
                .py-5.text-muted.text-center
                  i.fas.fa-image.fa-4x.mb-3
                  p Chưa có ảnh
            
            //- Thumbnail Strip
            - var allImages = [product.thumbnail].concat(product.images || []).filter(Boolean)
            if allImages.length > 1
              .tz-gallery-thumbs
                each img, idx in allImages
                  .tz-gallery-thumb(class=(idx === 0 ? "active" : "") onclick="changeGalleryImage(this, '" + img + "')")
                    img(src=img alt=`Ảnh ${idx + 1}`)

        //- Product Info
        .col-lg-7.col-md-6.pl-md-5
          h1.font-weight-bold.mb-3.tz-product-title-lg= product.title
          
          .d-flex.align-items-center.mb-4
            .d-flex.text-warning.mr-3.tz-stars-lg
              i.fas.fa-star
              i.fas.fa-star
              i.fas.fa-star
              i.fas.fa-star
              i.fas.fa-star.text-muted
            span.text-muted.mr-3.tz-rating-text (Đánh giá)
            span.text-muted.tz-rating-text | Đã bán 0

          //- Price
          .p-3.mb-4.tz-price-box
            if product.discountPercentage && product.discountPercentage > 0
              - var discountedPrice = Math.round(product.price * (1 - product.discountPercentage / 100))
              .d-flex.align-items-end
                .font-weight-bold.mr-3.tz-price-current-lg= discountedPrice.toLocaleString('vi-VN') + '₫'
                .text-muted.mb-1.tz-price-old-lg= product.price.toLocaleString('vi-VN') + '₫'
              .mt-1
                span.badge.badge-success.font-weight-normal.tz-badge-saving
                  | Tiết kiệm: #{(product.price - discountedPrice).toLocaleString('vi-VN')}₫
            else
              .font-weight-bold.tz-price-current-lg= product.price ? product.price.toLocaleString('vi-VN') + '₫' : 'Liên hệ'

          //- Stock
          .mb-3.tz-stock-status
            span.text-muted.mr-3 Trạng thái:
            if product.stock > 10
              span.tz-text-success-bold
                i.fas.fa-check-circle.mr-1
                | Còn hàng (#{product.stock})
            else if product.stock > 0
              span.font-weight-bold.text-warning
                i.fas.fa-exclamation-triangle.mr-1
                | Sắp hết (#{product.stock})
            else
              span.font-weight-bold.text-danger
                i.fas.fa-times-circle.mr-1
                | Hết hàng

          //- Brand
          if brand
            .mb-4.tz-stock-status
              span.text-muted.mr-3 Thương hiệu:
              .d-inline-flex.align-items-center.tz-brand-badge
                if brand.logo
                  img.tz-brand-logo(src=brand.logo alt=brand.name)
                span.font-weight-bold.tz-brand-name= brand.name

          //- Divider
          hr.my-4

          //- Thêm vào giỏ hàng
          if product.stock > 0
            form(action=`/cart/add/${product._id}` method="POST")
              .d-flex.align-items-center.mb-4
                span.text-muted.mr-4.tz-quantity-label Số lượng:
                .input-group.tz-quantity-input-group
                  .input-group-prepend
                    button.btn.btn-light.px-3.tz-quantity-btn(type="button" onclick="this.parentNode.nextElementSibling.stepDown()") -
                  input.form-control.text-center.border-0.px-0.tz-quantity-input(type="number" name="quantity" value="1" min="1" max=product.stock)
                  .input-group-append
                    button.btn.btn-light.px-3.tz-quantity-btn(type="button" onclick="this.parentNode.previousElementSibling.stepUp()") +
              
              .d-flex.mt-4
                button.btn.d-flex.align-items-center.justify-content-center.mr-3.tz-btn-add-cart(type="submit")
                  i.fas.fa-cart-plus.mr-2
                  | THÊM VÀO GIỎ
                //- Nút MUA NGAY
                button.btn.d-flex.align-items-center.justify-content-center.tz-btn-buy-now(type="submit" name="buyNow" value="true")
                  | MUA NGAY
          else
            .mt-4
              button.btn.btn-secondary.w-100.tz-btn-out-stock(disabled)
                i.fas.fa-ban.mr-2
                | SẢN PHẨM HẾT HÀNG

    //- Description Section
    if product.description
      .card.border-0.shadow-sm.mb-5
        .card-header.bg-white.py-3.tz-card-header-light
          h5.mb-0.font-weight-bold.tz-card-title-md Đặc điểm nổi bật
        .card-body.p-3
          .tz-product-desc.content-html.tz-product-desc-content!= product.description
