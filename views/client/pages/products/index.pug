extends ../../layouts/default
include ../../mixins/category-sidebar.pug
include ../../mixins/product-card.pug

block main
  .container.py-4
    nav(aria-label="breadcrumb")
      ol.breadcrumb.bg-transparent.px-0.pb-3.pt-0.mb-0.tz-breadcrumb-nav
        li.breadcrumb-item
          a.text-muted(href="/") Trang chủ
        if currentCategory
          li.breadcrumb-item
            a.text-muted(href="/products") Sản phẩm
          li.breadcrumb-item.active.tz-breadcrumb-active(aria-current="page")= currentCategory.title
        else if keyword
          li.breadcrumb-item
            a.text-muted(href="/products") Sản phẩm
          li.breadcrumb-item.active.tz-breadcrumb-active(aria-current="page") Tìm kiếm
        else
          li.breadcrumb-item.active.tz-breadcrumb-active(aria-current="page") Sản phẩm

    .row
      //- Sidebar filter
      .col-lg-3.col-md-4.mb-4
        form(action="/products" method="GET" id="filter-form")
          if keyword
            input(type="hidden" name="keyword" value=keyword)
          
          .tz-sidebar.mt-2.p-3.border.rounded.bg-white
            .tz-sidebar-header.d-flex.align-items-center.mb-4.pb-2.border-bottom
              i.fas.fa-filter.mr-2(class="tz-auto-cd5a6f")
              h5.mb-0.font-weight-bold(class="tz-auto-beab58") Bộ lọc tìm kiếm
            
            //- Category Filter
            .tz-filter-group.mb-4
              h6.tz-filter-title.font-weight-bold.mb-3 Danh mục sản phẩm
              
              each cat in productCategories
                .custom-control.custom-radio.mb-2
                  input.custom-control-input(
                    type="radio" 
                    name="category" 
                    id=`cat-${cat.slug}` 
                    value=cat.slug 
                    checked=(currentCategory && currentCategory.slug === cat.slug)
                  )
                  label.custom-control-label(for=`cat-${cat.slug}`)= cat.title
                  
            //- Brand Filter
            .tz-filter-group.mb-4
              h6.tz-filter-title.font-weight-bold.mb-3 Thương hiệu
              if brands && brands.length > 0
                each brand in brands
                  .custom-control.custom-checkbox.mb-2
                    input.custom-control-input(
                      type="checkbox" 
                      name="brand" 
                      id=`brand-${brand.slug}` 
                      value=brand.slug 
                      checked=(selectedBrands && selectedBrands.includes(brand.slug))
                    )
                    label.custom-control-label(for=`brand-${brand.slug}`)= brand.name
              else
                p.text-muted.small Chưa có thương hiệu nào
                  
            button.btn.btn-primary.w-100.mb-2(type="submit" style="background-color: #0b93d5; border-color: #0b93d5;") Áp dụng
            a.d-block.text-center.text-muted(href="/products" style="text-decoration: none; transition: font-weight 0.2s; font-size: 14px;" onmouseover="this.style.fontWeight='bold'" onmouseout="this.style.fontWeight='normal'") Xóa tất cả

      //- Nội dung chính
      .col-lg-9.col-md-8
        .d-flex.align-items-center.mb-4.pb-3.border-bottom
          .page-header-left
            if keyword
              h3.mb-1.tz-page-title-md Kết quả tìm kiếm: "#{keyword}"
            else
              h3.mb-1.tz-page-title-md= currentCategory ? currentCategory.title : 'Tất cả sản phẩm'
            span.text-muted.tz-text-sm Tìm thấy <strong>#{products.length}</strong> kết quả

        if products && products.length > 0
          .row
            each product in products
              .col-lg-4.col-md-6.mb-4
                +productCard(product)
        else
          .text-center.py-5
            .empty-state
              i.fas.fa-box-open.fa-4x.text-muted.mb-3
              h4.text-muted Không có sản phẩm nào
              if currentCategory
                p.text-muted Danh mục này chưa có sản phẩm
                a.btn.btn-outline-secondary(href="/products") Xem tất cả sản phẩm
              else
                p.text-muted Hiện tại chưa có sản phẩm nào để hiển thị
